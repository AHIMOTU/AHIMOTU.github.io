<html data-theme="valentine">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, viewport-fit=cover"/>
    <link href="https://cdn.bootcdn.net/ajax/libs/daisyui/3.5.1/full.min.css" rel="stylesheet" type="text/css"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      [v-cloak] {
        display: none;
      }
      .canvas-btn {
        box-shadow: 0 2px 3px 0 rgba(60,64,67,.3), 0 6px 10px 4px rgba(60,64,67,.15);
      }
    </style>
</head>
<body>

<div id="app" class="bg-base-100">
    <canvas id="my-canvas" class="fixed top-0 left-0 z-[1000] pointer-events-none"></canvas>
    <!--<div-->
    <!--    class="canvas-btn fixed right-5 bottom-10 z- flex justify-center items-center w-16 h-16 rounded-full"-->
    <!--    @click="onClickCanvasBtn"-->
    <!--&gt;-->
    <!--    <img class="w-8 h-8" src="https://www.gstatic.com/delight/animation-engine/halloween/ghost_button.png" alt="">-->
    <!--</div>-->


    <div v-if="isLove && visible" v-cloak>
        <div class="flex flex-col items-center py-4">
            <span class="pr-4 font-mono text-4xl">ç›¸è¯†</span>
            <div class="grid grid-flow-col gap-5 text-center auto-cols-max pt-2">
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedKnowTimeData.days }}</span>
                    <span>days</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedKnowTimeData.hours }}</span>
                    <span>hours</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedKnowTimeData.minutes }}</span>
                    <span>min</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedKnowTimeData.seconds }}</span>
                    <span>sec</span>
                </div>
            </div>
        </div>
        <div class="flex flex-col items-center py-4">
            <span class="pr-4 font-mono text-4xl">ç›¸è§</span>
            <div class="grid grid-flow-col gap-5 text-center auto-cols-max pt-2">
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedMeetTimeData.days }}</span>
                    <span>days</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedMeetTimeData.hours }}</span>
                    <span>hours</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedMeetTimeData.minutes }}</span>
                    <span>min</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedMeetTimeData.seconds }}</span>
                    <span>sec</span>
                </div>
            </div>
        </div>
        <div v-if="isLove" class="flex flex-col items-center py-4">
            <span class="pr-4 font-mono text-4xl" @click="visible = false">ç›¸æ‹</span>
            <div class="grid grid-flow-col gap-5 text-center auto-cols-max pt-2">
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedLoveTimeData.days }}</span>
                    <span>days</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedLoveTimeData.hours }}</span>
                    <span>hours</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedLoveTimeData.minutes }}</span>
                    <span>min</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ passedLoveTimeData.seconds }}</span>
                    <span>sec</span>
                </div>
            </div>
        </div>
        <div class="flex flex-col items-center py-4">
            <span class="pr-4 font-mono text-4xl">ä¸‹æ¬¡ç›¸è§</span>
            <div class="grid grid-flow-col gap-5 text-center auto-cols-max pt-2">
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ nextMeetTimeData.days }}</span>
                    <span>days</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ nextMeetTimeData.hours }}</span>
                    <span>hours</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ nextMeetTimeData.minutes }}</span>
                    <span>min</span>
                </div>
                <div class="flex flex-col p-2 bg-neutral rounded-box text-neutral-content">
                    <span class="font-mono text-3xl">{{ nextMeetTimeData.seconds }}</span>
                    <span>sec</span>
                </div>
            </div>
        </div>
        <div class="flex flex-col items-center py-4">
            <button class="btn" @click="jumpReport">ç‚¹å‡»æŸ¥çœ‹ä¸“å±å¹´åº¦æŠ¥å‘Š</button>
        </div>
        <!-- Open the modal using ID.showModal() method -->
        <div v-if="showBtn" class="flex flex-col items-center py-4">
            <button class="btn" onclick="my_modal_1.showModal()">æƒ³å¯¹ä½ è¯´</button>
        </div>
        <dialog id="my_modal_1" class="modal">
            <form method="dialog" class="modal-box">
                <h3 class="font-bold text-lg">äº²çˆ±çš„åª›å®</h3>
                <p class="py-4">æˆ‘ä»¬åœ¨ä¸€èµ·100å¤©å•¦ï¼ğŸ‘</p>
                <p class="py-4">
                    ä½ æ›¾é—®æˆ‘100å¤©æœ‰ä»€ä¹ˆçºªå¿µçš„<br>
                    åœ¨æˆ‘çœ‹æ¥100å¤©<br>
                    æ„å‘³ç€å½¼æ­¤æ›´æ·±çš„äº†è§£<br>
                    æ„å‘³ç€äº’ç›¸çš„è®¤å¯<br>
                    æ„å‘³ç€æ„Ÿæƒ…çš„æ–°é˜¶æ®µ
                </p>
                <p class="py-4">
                    æˆ‘ä»¬çš„100å¤©<br>
                    ä¸ä¹‹å‰å¥½åƒ<br>
                    ä¾ç„¶æœ‰è¯´ä¸å®Œçš„è¯é¢˜<br>
                    ä¾ç„¶æ²¡æœ‰é”™è¿‡å½¼æ­¤çš„æ¯ä¸€ä¸ªèŠ‚æ—¥<br>
                    æˆ‘ä¾ç„¶æ˜¯æœ€å¹¸è¿å’Œå¹¸ç¦çš„äºº<br>
                    ä½ ä¾ç„¶æ˜¯æœ€å¯çˆ±çš„ã€æœ€ç¾ä¸½ã€æœ€ä¼˜ç§€çš„å¥³ç”Ÿ<br>
                    ä½†åˆä¸ä¸€æ ·<br>
                    æœ‰ä¸€èµ·é¢å¯¹è¿‡ä»æœªé‡åˆ°è¿‡çš„å›°éš¾<br>
                    æœ‰ä»¤äººéš¾å¿˜çš„å››å·ä¹‹æ—…<br>
                    å½“ç„¶ä¹Ÿæœ‰æƒ¹ä½ ä¸é«˜å…´<br>
                    æœ‰è‹¦æœ‰ç”œã€æœ‰å¼€å¿ƒæœ‰éš¾è¿‡<br>
                    ä½†æˆ‘ä»¬ä¸€èµ·è¯ é‡Šäº†ä»€ä¹ˆæ˜¯æƒ…æ¯”é‡‘åšâ¤ï¸â€ğŸ”¥
                </p>
                <p class="py-4">
                    å¸Œæœ›æˆ‘ä»¬<br>
                    èƒ½ä¸€ç›´é™ªåœ¨å½¼æ­¤èº«è¾¹<br>
                    èƒ½æˆä¸ºå½¼æ­¤æœ€çˆ±çš„äºº<br>
                    èµ°åˆ°æœ€åğŸ‘©â€â¤ï¸â€ğŸ‘¨
                </p>
                <p class="py-4">ä¸‹ä¸€ä¸ª100å¤©ï¼Œæˆ‘ä»¬æ¥å•¦ï¼</p>
                <div class="modal-action">
                    <button class="btn">çˆ±ä½ çš„æ¹˜å­</button>
                </div>
                <!--<h3 class="font-bold text-lg">MYåª›å®</h3>-->
                <!--<p class="py-4">ä¸ƒå¤•å¿«ä¹ï¼Œè¦æ°¸è¿œå¼€å¿ƒå“Ÿï¼<br />æ— è®ºå‘ç”Ÿä»€ä¹ˆäº‹ï¼Œæˆ‘éƒ½åœ¨ä½ èº«è¾¹ï¼</p>-->
                <!--<div class="modal-action">-->
                <!--    <button class="btn">æ¹˜å­</button>-->
                <!--</div>-->
                <!--<h3 class="font-bold text-lg">å¼ è€å¸ˆ</h3>-->
                <!--<p class="py-4">æ•™å¸ˆèŠ‚å¿«ä¹ï¼æ„¿ä½ å¼€å¿ƒå·¥ä½œæ¯ä¸€å¤©ï¼<br />PS: æˆ‘çš„åª›å®è¾›è‹¦å•¦ï¼å¸Œæœ›ä½ èƒ½æ—©ç‚¹å½“ä¸Šé¢†å¯¼ä¸å†è¢«æ¬ºè´ŸğŸ˜</p>-->
                <!--<div class="modal-action">-->
                <!--    <button class="btn">å¼ åŒå­¦</button>-->
                <!--</div>-->
            </form>
        </dialog>
    </div>
    <div v-else v-cloak class="letter p-2">
        <p class="pb-2">æˆ‘ä»¬çš„æ•…äº‹ä»2023å¹´6æœˆ4å·å¼€å§‹</p>
        <p>ä½ æ˜¯é‚£ä¹ˆçš„ä¼˜é›…</p>
        <p>ç¬¬ä¸€æ¬¡è§é¢æ—¶çš„ç™½è‰²é•¿è£™è®©æˆ‘å°è±¡æ·±åˆ»</p>
        <p>ä½ æ˜¯é‚£ä¹ˆçš„æ¸©æŸ”</p>
        <p>å’Œä½ è¯´è¯æ€»æ˜¯æ„Ÿåˆ°å¾ˆèˆ’æœ</p>
        <p>ä½ æ˜¯é‚£ä¹ˆçš„ä¹è§‚</p>
        <p>æ— è®ºé‡åˆ°ä»€ä¹ˆäº‹éƒ½æ˜¯å¼€å¿ƒé¢å¯¹</p>
        <p>ä½ æ˜¯é‚£ä¹ˆçš„è‡ªä¿¡</p>
        <p>ä¸äººäº¤è°ˆæ€»æ˜¯æ— è¯ä¸è¯´</p>
        <p>ä½ æ˜¯é‚£ä¹ˆçš„ä¸Šè¿›</p>
        <p>ä»é«˜ä¸­åˆ°å¤§å­¦åˆ°å·¥ä½œéƒ½æ˜¯è¿™æ ·</p>
        <p>ä½ æ˜¯é‚£ä¹ˆçš„ç‹¬ç«‹</p>
        <p>åœ¨å¤§å­¦å°±åšè¿‡é‚£ä¹ˆå¤šçš„å…¼èŒ</p>
        <p>ä½ æ˜¯é‚£ä¹ˆçš„æ‰§ç€</p>
        <p>ä¸ºäº†è§£å‡ºå…«çš‡åæ¸¸æˆå¯ä»¥æŠ•å…¥å‡ ä¸ªå°æ—¶</p>
        <p>ä½ æ˜¯é‚£ä¹ˆçš„ä¼˜ç§€</p>
        <p>ä½ æ˜¯é‚£ä¹ˆçš„å¯çˆ±</p>
        <p>......</p>
        <p>å’Œä½ ç›¸å¤„çš„è¶Šä¹… æˆ‘è¶Šè§‰å¾—æˆ‘é‡åˆ°å–œæ¬¢çš„äººäº†</p>
        <p>æˆ‘ä¸å¤ªæ“…é•¿è¡¨è¾¾ ä½†å°±åƒæˆ‘ä¸€ç›´å¯¹ä½ è¯´çš„</p>
        <p>æˆ‘ä¼šç”¨çœŸå¿ƒç”¨è¡ŒåŠ¨æ¥è¯æ˜æˆ‘å¯¹ä½ çš„å–œæ¬¢</p>
        <p>æˆ‘æ„¿æ„</p>
        <p>é™ªä½ ä¸€èµ·æŠ“å¨ƒå¨ƒ</p>
        <p>é™ªä½ å®Œæˆ66ä¸ªå¿ƒæ„¿</p>
        <p>é™ªä½ å»ä½ æƒ³å»çš„åœ°æ–¹æ—…æ¸¸</p>
        <p>é™ªä½ è¿‡ä½ æƒ³è¿‡çš„æ‰€æœ‰èŠ‚æ—¥</p>
        <p>é™ªä½ åšä¸€åˆ‡ä½ å–œæ¬¢çš„äº‹</p>
        <p class="pt-2">åœ¨æˆ‘ä»¬ç›¸è¯†çš„{{ passedKnowTimeData.days }}å¤© ç›¸è§çš„{{ passedMeetTimeData.days }}å¤©é‡Œ</p>
        <p>æˆ‘ä»¬å·²ç»ä»é™Œç”Ÿäººåˆ°ç†Ÿäººåˆ°æ™®é€šæœ‹å‹å†åˆ°æ— è¯ä¸è°ˆçš„æœ‹å‹</p>
        <p>æ­¤æ—¶æ­¤åˆ»æˆ‘æƒ³å¯¹ä½ è¯´</p>
        <div class="py-5 text-center">
            <button v-if="!isLove" class="btn" @click="onClick">
                åšæˆ‘å¥³æœ‹å‹å§
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
            </button>
            <button v-else class="btn" @click="visible = true">
                ä½ è¿˜æ˜¯æˆ‘çš„å¥³æœ‹å‹
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>
            </button>
        </div>
    </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/vue/3.2.47/vue.global.min.js"></script>
<script src="./canvas.js"></script>
<script>
  if (location.search.includes('debugger')) {
    localStorage.clear();
  }

  const { createApp, ref, computed, onMounted } = Vue

  //
  const knowTime = new Date('2023-06-04 12:45:21').getTime();
  const meetTime = new Date('2023-06-22 18:11:25').getTime();
  let loveTime = new Date('2023-08-13 23:53:46').getTime();
  const nextMeetTime = new Date('2024-01-28 14:00:00').getTime();

  const SECOND = 1000;
  const MINUTE = 60 * SECOND;
  const HOUR = 60 * MINUTE;
  const DAY = 24 * HOUR;

  function parseTimeData(time) {
    const days = Math.floor(time / DAY);
    const hours = Math.floor((time % DAY) / HOUR);
    const minutes = Math.floor((time % HOUR) / MINUTE);
    const seconds = Math.floor((time % MINUTE) / SECOND);
    const milliseconds = Math.floor(time % SECOND);

    return {
      days: padZero(days),
      hours: padZero(hours),
      minutes: padZero(minutes),
      seconds: padZero(seconds),
      milliseconds,
    };
  }

  function padZero(num, targetLength = 2) {
    let str = num + '';

    while (str.length < targetLength) {
      str = '0' + str;
    }

    return str;
  }

  createApp({
    setup() {
      const isLove = ref(!!loveTime)
      const visible = ref(true)
      const passedKnowTimeData = ref({
        days: 0,
        hours: 0,
        minutes: 0,
        seconds: 0,
      })
      const passedMeetTimeData = ref({
        days: 0,
        hours: 0,
        minutes: 0,
        seconds: 0,
      })
      const passedLoveTimeData = ref({
        days: 0,
        hours: 0,
        minutes: 0,
        seconds: 0,
      })
      const nextMeetTimeData = ref({
        days: 0,
        hours: 0,
        minutes: 0,
        seconds: 0,
      })
      onMounted(() => {
        count();
      })

      function count() {
        setTimeout(() => {
          passedKnowTimeData.value = parseTimeData(Date.now() - knowTime)
          passedMeetTimeData.value = parseTimeData(Date.now() - meetTime)
          if (loveTime) {
            passedLoveTimeData.value = parseTimeData(Date.now() - loveTime)
          }
          nextMeetTimeData.value = parseTimeData(nextMeetTime - Date.now())
          count();
        }, 1000)
      }

      function onClick() {
        loveTime = Date.now();
        isLove.value = true;
        localStorage.setItem('love-time', Date.now() + '');
      }

      // const showBtn = ref(new Date().setHours(0, 0, 0, 0) === new Date('2023/8/22').getTime())
      // const showBtn = ref(new Date().setHours(0, 0, 0, 0) === new Date('2023/9/10').getTime())
      const showBtn = computed(() => passedLoveTimeData.value.days == 100)

      const halloweenAnimation = ref()
      const counter = ref(0)
      const flag = ref(false)
      onMounted(async () => {
        halloweenAnimation.value = new HalloweenAnimation('#my-canvas')
        await halloweenAnimation.value.init()
        flag.value = true
      })
      function onClickCanvasBtn() {
        if (!flag.value) return

        const intervalID = setInterval(() => {
          if (counter.value > 16) {
            clearInterval(intervalID)
            counter.value = 0

            return
          }
          halloweenAnimation.value.start()
          counter.value++
        }, 500)
      }

      function jumpReport() {
        location.href = '/report.html'
      }

      return {
        visible,
        isLove,
        passedKnowTimeData,
        passedMeetTimeData,
        passedLoveTimeData,
        nextMeetTimeData,
        showBtn,
        onClick,
        onClickCanvasBtn,
        jumpReport
      }
    }
  }).mount('#app')
</script>
</body>
</html>
